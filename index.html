<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>socket</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <div id="overlay" class="owerlov"></div>
    <div class="container">
      <div class="header">Socket bilan dars</div>
      <div class="chat-container"></div>
     <div class="bottom">
  <img  id="preview" src="" alt="" />
  <input type="file" id="fileInput" accept="image/*" style="display:none" />
  <label for="fileInput" class="upload"><i class="fas fa-file-upload"></i></label>
  <input type="text" id="tkst" placeholder="Habar kiriting" class="input" />
  <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
</div>

<script>
const socket = io();

const preview = document.getElementById("preview");
const fileInput = document.getElementById("fileInput");

// PREVIEW IMAGE
fileInput.addEventListener("change", function () {
  const file = this.files[0];
  if (file) {
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  }
});

// SEND MESSAGE
function sendMessage() {
  const text = document.getElementById("tkst").value;

  // Agar foydalanuvchi rasm tanlagan bo'lsa
  const file = fileInput.files[0];

  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const imageData = e.target.result; // base64
      socket.emit("chat message", { text: text, image: imageData });
    };
    reader.readAsDataURL(file);
  } else if (text.trim() !== "") {
    socket.emit("chat message", { text: text });
  }

  document.getElementById("tkst").value = "";
  fileInput.value = "";
  preview.src = "";
  preview.style.display = "none";
}
const overlay = document.getElementById("overlay");
const chatContainer = document.querySelector(".chat-container");

// chat-container ichidagi rasmga bosilganda overlay chiqarish
chatContainer.addEventListener("click", function(e){
  if(e.target.classList.contains("message-image")){
    overlay.style.display = "flex";
    const overlayImage = document.createElement("img");
    overlayImage.src = e.target.src;
    overlayImage.classList.add("overlay-image");
    overlay.appendChild(overlayImage);
  }
});

// overlay bosilganda yopish
overlay.addEventListener("click", function(){
  overlay.style.display = "none";
  overlay.innerHTML = "";
});

// RECEIVE MESSAGE
socket.on("chat message", function (data) {
  const chatContainer = document.querySelector(".chat-container");
  const messageDiv = document.createElement("div");
  messageDiv.classList.add(data.id === socket.id ? "message-1" : "message-2");

  // Text
  if (data.text) {
    const p = document.createElement("p");
    p.textContent = data.text;
    messageDiv.appendChild(p);
  }

  // Image
  if (data.image) {
    const img = document.createElement("img");
    
    img.classList.add("message-image");
   img.src= data.image
    messageDiv.appendChild(img);
  }

  chatContainer.appendChild(messageDiv);

}
);

document.getElementById("tkst").addEventListener("keydown",function(e){
  if (e.key === "Enter"){
    sendMessage()
  }
})


</script>

  </body>
</html>
